## ğŸ¯ BÃ i toÃ¡n tá»‘i Æ°u:

Báº¡n cÃ³:

* `N` DEXes (VD: Uniswap, Kyber, Bancorâ€¦)
* `parts` pháº§n nhá» cá»§a tá»•ng amount (VD: chia 1000 DAI thÃ nh 10 pháº§n = 100 DAI/part)
* `matrix[i][j]`: lá»£i nhuáº­n (return amount) náº¿u phÃ¢n `j` parts vÃ o DEX `i`.

**Má»¥c tiÃªu**: chá»n cÃ¡ch phÃ¢n `parts` vÃ o `N` DEX sao cho **tá»•ng return lÃ  lá»›n nháº¥t**.

---

## ğŸ§  Dynamic Programming Idea:

### ğŸ¯ Biáº¿n DP:

```solidity
dp[i][j] = maximum return cÃ³ thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c
          náº¿u dÃ¹ng i DEX Ä‘áº§u tiÃªn vÃ  tá»•ng cá»™ng j parts
```

* `i âˆˆ [0, n-1]` (DEX index)
* `j âˆˆ [0, parts]` (sá»‘ pháº§n Ä‘Ã£ phÃ¢n phá»‘i)

---

## ğŸ” CÃ´ng thá»©c quy hoáº¡ch Ä‘á»™ng:

```solidity
dp[i][j] = max over k âˆˆ [0..j] of {
    dp[i-1][j-k] + matrix[i][k]
}
```

* NghÄ©a lÃ : Ä‘á»ƒ Ä‘áº¡t `j` parts qua `i` DEX, báº¡n xÃ©t thá»­ **chia `k` parts cho DEX `i`**, vÃ  `j-k` parts cÃ²n láº¡i cho `i-1` DEX trÆ°á»›c Ä‘Ã³.

---

## ğŸ§© Truy váº¿t Ä‘Æ°á»ng phÃ¢n phá»‘i:

Sau khi tÃ­nh `dp[n-1][parts]` lÃ  **tá»•ng return tá»‘i Ä‘a**, báº¡n **quay ngÆ°á»£c láº¡i** Ä‘á»ƒ xÃ¡c Ä‘á»‹nh má»—i DEX Ä‘Ã£ Ä‘Æ°á»£c cáº¥p bao nhiÃªu part â†’ tráº£ vá» máº£ng `distribution`.

---

## ğŸ“¦ Solidity Implementation

### TÃªn hÃ m:

```solidity
function _findBestDistribution(...) internal pure returns (
    uint256 returnAmount,
    uint256[] memory distribution
)
```

### Key lines:

```solidity
// dp[i][j] = max return using i DEXes and j parts
uint256[][] memory answer = new uint256[][](n);
uint256[][] memory prev = new uint256[][](n);

// fill DP
for (uint256 i = 0; i < n; i++) {
    for (uint256 j = 0; j <= parts; j++) {
        for (uint256 k = 0; k <= j; k++) {
            uint256 newValue = answer[i-1][j-k] + matrix[i][k];
            if (newValue > answer[i][j]) {
                answer[i][j] = newValue;
                prev[i][j] = k; // backtrack pointer
            }
        }
    }
}

// backtrack to reconstruct best distribution
```

---

## ğŸ“ˆ VÃ­ dá»¥ nhá»:

```text
3 DEX: Uniswap, Kyber, Bancor
4 parts
matrix = [
  [10, 18, 24, 28, 30], // Uniswap
  [9, 19, 27, 32, 35],  // Kyber
  [7, 17, 23, 29, 31]   // Bancor
]
```

Ã nghÄ©a: náº¿u cho 3 parts vÃ o Kyber â†’ nháº­n Ä‘Æ°á»£c 32 DAI.

Goal: phÃ¢n phá»‘i 4 parts vÃ o 3 DEX sao cho tá»•ng return lá»›n nháº¥t.

---

## âœ… Æ¯u Ä‘iá»ƒm:

* Cho phÃ©p chia **amount theo tá»· lá»‡** giá»¯a nhiá»u DEX
* GiÃºp giáº£m **slippage** vÃ  tÄƒng lá»£i nhuáº­n khi DEX thanh khoáº£n háº¡n cháº¿

