## ğŸ¯ Vá»‹ trÃ­ logic **DEX Aggregation + Path Optimization**:

### ğŸ” Táº­p trung vÃ o 2 contract chÃ­nh:

---

### 1ï¸âƒ£ `OneSplit.sol`

> âœ… **ÄÃ¢y lÃ  contract chÃ­nh chá»‹u trÃ¡ch nhiá»‡m tÃ¬m Ä‘Æ°á»ng DEX tá»‘i Æ°u Ä‘á»ƒ swap token.**

#### ğŸ”¸ Key function:

```solidity
function getExpectedReturn(
    IERC20 fromToken,
    IERC20 toToken,
    uint256 amount,
    uint256 parts,
    uint256 flags
) public view returns(
    uint256 returnAmount,
    uint256[] memory distribution
)
```

#### ğŸ” Ã nghÄ©a:

* `parts`: sá»‘ lÆ°á»£ng pháº§n chia nhá» amount Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ hiá»‡u quáº£ route (VD: 10 â†’ chia 10 pháº§n).
* `flags`: chá»‰ Ä‘á»‹nh loáº¡i DEX nÃ o Ä‘Æ°á»£c phÃ©p dÃ¹ng (VD: Uniswap, Kyber, Bancorâ€¦).
* `distribution`: máº£ng káº¿t quáº£ thá»ƒ hiá»‡n **phÃ¢n phá»‘i bao nhiÃªu pháº§n trÄƒm qua má»—i DEX**.

---

### 2ï¸âƒ£ `OneSplitBase.sol`

> ğŸ“Œ ÄÃ¢y lÃ  **contract trá»«u tÆ°á»£ng (abstract)** chá»©a logic tÃ­nh toÃ¡n chung cho viá»‡c aggregate.

#### ğŸ”¸ CÃ¡c hÃ m quan trá»ng:

```solidity
function _getExpectedReturnRespectingGas(...) internal view returns(...) { ... }

function _findBestDistribution(...) internal pure returns (...) {
    // Dynamic programming Ä‘á»ƒ phÃ¢n phá»‘i amount tá»‘i Æ°u
}
```

Äáº·c biá»‡t:

```solidity
_getExpectedReturnRespectingGas(...) 
â†’ gá»i hÃ m getReturn tá»« tá»«ng DEX 
â†’ gom láº¡i vÃ  tÃ­nh route tá»‘t nháº¥t dá»±a trÃªn return vÃ  gas.
```

---

### 3ï¸âƒ£ CÃ¡c DEX cá»¥ thá»ƒ implement á»Ÿ cÃ¡c contract phá»¥:

* `OneSplitAave.sol`
* `OneSplitCompound.sol`
* `OneSplitMStable.sol`
* `OneSplitFulcrum.sol`
* v.vâ€¦

Má»—i contract cÃ³ `getReturn` riÃªng, tráº£ vá» expected return náº¿u swap á»Ÿ DEX Ä‘Ã³.

---

## ğŸ§  Tá»•ng quan Flow tÃ¬m Ä‘Æ°á»ng swap tá»‘i Æ°u:

```
OneSplit.getExpectedReturn() 
   â¤· gá»i cÃ¡c getReturn() tá»« DEX cá»¥ thá»ƒ (Aave, Uniswap, etc)
   â¤· tÃ­nh return & gas cost
   â¤· gá»i _findBestDistribution Ä‘á»ƒ chia amount qua nhiá»u DEX
   â¤· tráº£ vá» returnAmount + distribution
```

